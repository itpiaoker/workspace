<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="./js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="./js/jsplumb.min.js "></script>
    <script type="text/javascript" src="./js/01.js "></script>
    <link href="./js/jquery-ui.min.css" rel="stylesheet" />

    <script>

        //1.创建模型（参数依次为：drop事件的ui、当前容器、id、当前样式）
        function CreateModel(ui, selector) {
            //1.1 添加html模型
            var modelid = $(ui.draggable).attr("id");
            i++;
            var id = modelid + i;
            var cur_css = modelid;
            var type = $(ui.helper).attr("dbtype");
            $(selector).append('<div class="node ' + cur_css + '" id="' + id + '" dbtype="' + type + '" parentid="' + $(selector).attr("id") + '" onclick="oInitElement.GetPropertiesByType(\'' + type + '\',this)" ondblclick="InitStation().DbClick(\'' + type + '\',this)" >' + $(ui.helper).html() + '</div>');
            var left = parseInt(ui.offset.left - $(selector).offset().left);
            var top = parseInt(ui.offset.top - $(selector).offset().top);
            $("#" + id).css("left", left).css("top", top);
            //jsPlumb.setContainer($("#divCenter"));
            //1.2 添加连接点
            jsPlumb.addEndpoint(id, { anchors: "RightMiddle" }, hollowCircle);
            jsPlumb.addEndpoint(id, { anchors: "LeftMiddle" }, hollowCircle);
            jsPlumb.addEndpoint(id, { anchors: "TopCenter" }, hollowCircle);
            jsPlumb.addEndpoint(id, { anchors: "BottomCenter" }, hollowCircle);
            jsPlumb.draggable(id);

            //1.3 注册实体可draggable和resizable
            $("#" + id).draggable({
                containment: "parent",
                start: function () {
                    startMove();
                },
                drag: function (event, ui) {
                    MoveSelectDiv(event, ui, id);
                    jsPlumb.repaintEverything();
                },
                stop: function () {
                    jsPlumb.repaintEverything();
                }
            });

            $("#" + id).resizable({
                resize: function () {
                    jsPlumb.repaintEverything();
                },
                stop: function () {
                    jsPlumb.repaintEverything();
                    //oInitElement.SendPropRequest("DTO_TM_PLANT", $(this));
                }
            });
            return id;
        };

    </script>
</head>
<body>
<div id="divContentLeftMenu">
    <div class="sidebar-menu" id="divSidebar">
        <a href="#plantmodel" onclick="Resize()" class="nav-header menu-first collapsed" data-toggle="collapse">工厂模型</a>
        <ul id="plantmodel" class="nav nav-list collapse menu-second">
        </ul>
        <a href="#artlinemodel" onclick="Resize()" class="nav-header menu-first collapsed" data-toggle="collapse">工艺段模型</a>
        <ul id="artlinemodel" class="nav nav-list collapse menu-second">
            <li>
                <a href="#">
                    <div class="node radius" id="node4" dbtype="DTO_TM_ART_LINE">
                        <label>工段</label>
                    </div>
                </a>
            </li>
            <li>
                <a href="#">
                    <div class="node" id="node5" dbtype="DTO_TM_ULOC">
                        <label>工位</label>
                    </div>
                </a>
            </li>
        </ul>
    </div>
</div>
<div id="divCenter"></div>
</body>
</html>