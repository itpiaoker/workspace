{"version":3,"sources":["services/application.js"],"names":["app","factory","$resource","service","Auth","Session","Util","_this","hasLogin","user","hasAuthorized","authCode","auth","getAuth","sFn","eFn","get","response","ok","data","getData","create","userId","loginName","constant","GetAuthSuccess","GetAuthFailed","SessionTimeout","LogoutSuccess","LicenseExpired","currentUser","userAuth","userobj","id","destroy","$cookies","Object","assign","key","_default","token","trim","clear","remove","userid"],"mappings":"AAAA;;;;;;;AAKAA,IAAIC,QAAQ,sBAAQ,UAAUC,WAAW;;CAErC,OAAOA,UAAU;IAClBC,QAAQ,2CAAe,UAAUC,MAAMC,SAASC,MAAM;CACxD,IAAIC,QAAM;;CAEV,KAAKC,WAAW,YAAY;EAC3B,OAAO,CAAC,CAACH,QAAQI;;;CAGlB,KAAKC,gBAAgB,UAAUC,UAAU;EACxC,OAAQJ,MAAMC,cAAc,EAAEH,QAAQO,KAAKD,cAAY;;;CAGxD,KAAKE,UAAQ,UAAUC,KAAIC,KAAK;EAC/BX,KAAKY,IAAI,UAAUC,UAAU;GAC5B,IAAG,CAACX,KAAKW,SAASC,GAAGD,WAAU;IAC9BF,IAAIE;IACJ,OAAO;;GAER,IAAIE,OAAKb,KAAKW,SAASG,QAAQH;GAC/BZ,QAAQgB,OAAOF,KAAKV,KAAKa,QAAOH,KAAKV,KAAKc,WAAUJ,KAAKP,MAAKO,KAAKV;GACnEK,IAAIK,KAAKV;KACRM;;IAEDS,SAAS,eAAe;CAC1BC,gBAAgB;CAChBC,eAAe;CACfC,gBAAgB;CAChBC,eAAe;CACfC,gBAAgB;;;;;AAKjB7B,IAAIG,QAAQ,WAAW,YAAY;CAClC,KAAKkB,SAAS,UAAUC,QAAQQ,aAAYC,UAASC,SAAS;EAC7D,KAAKC,KAAKX;EACV,KAAKb,OAAOqB;EACZ,KAAKlB,OAAOmB;EACN,KAAKC,UAAUA;;CAEtB,KAAKE,UAAU,YAAY;EAC1B,KAAKD,KAAK;EACV,KAAKxB,OAAO;EACZ,KAAKG,OAAK;EACJ,KAAKoB,UAAU;;CAEtB,OAAO;;;;;AAKRhC,IAAIG,QAAQ,sBAAS,UAAUgC,UAAU;CACxCC,OAAOC,OAAO,MAAK;EAClBC,KAAI;EACJtB,KAFkB,SAAA,IAEduB,UAAS;GACZ,IAAIC,QAAQL,SAASnB,IAAI,KAAKsB;GACrB,IAAI,CAACE,SAASA,MAAMC,WAAW,IAAI;IAC3C,IAAGF,UAAS;KACIC,QAAQD;;;GAGzB,OAAOC;;EAERE,OAXkB,SAAA,QAWX;GACNP,SAASQ,OAAO,KAAKL;;;CAGvB,OAAO;;;;;AAKRtC,IAAIG,QAAQ,8BAAiB,UAAUgC,UAAU;CAC7CC,OAAOC,OAAO,MAAK;EACfC,KAAI;EACJtB,KAFe,SAAA,IAEXuB,UAAS;GACT,IAAIK,SAAST,SAASnB,IAAI,KAAKsB;GAC/B,IAAI,CAACM,UAAUA,OAAOH,WAAW,IAAI;IACjC,IAAGF,UAAS;KACRK,SAASL;;;GAGjB,OAAOK;;EAEXF,OAXe,SAAA,QAWR;GACPP,SAASQ,OAAO,KAAKL;;;CAG7B,OAAO;;;;;AAKPtC,IAAIG,QAAQ,4BAAe,UAAUgC,UAAU;CAC3CC,OAAOC,OAAO,MAAK;EACfC,KAAI;EACJtB,KAFe,SAAA,IAEXuB,UAAS;GACT,IAAIC,QAAQL,SAASnB,IAAI,KAAKsB;GAC9B,IAAI,CAACE,SAASA,MAAMC,WAAW,IAAI;IAC/B,IAAGF,UAAS;KACRC,QAAQD;;;GAGhB,OAAOC;;EAEXE,OAXe,SAAA,QAWR;GACPP,SAASQ,OAAO,KAAKL;;;CAG7B,OAAO;IAhBP","file":"application.js","sourcesContent":["/**\r\n * Description: 授权服务\r\n * Author: xinfeng_qian\r\n * Update: xinfeng_qian(2016-10-09 15:16)\r\n */\r\napp.factory('Auth', function ($resource) {\r\n\t//return $resource('json/authorization.json');\r\n    return $resource('system/auth/userInfo');\r\n}).service('AuthService', function (Auth, Session, Util) {\r\n\tlet _this=this;\r\n\t//已登录\r\n\tthis.hasLogin = function () {\r\n\t\treturn !!Session.user;\r\n\t};\r\n\t//已授权\r\n\tthis.hasAuthorized = function (authCode) {\r\n\t\treturn (_this.hasLogin() && !(Session.auth[authCode]===false));\r\n\t};\r\n\t//获取授权信息\r\n\tthis.getAuth=function (sFn,eFn) {\r\n\t\tAuth.get(function (response) {\r\n\t\t\tif(!Util.response.ok(response)){\r\n\t\t\t\teFn(response);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tlet data=Util.response.getData(response);\r\n\t\t\tSession.create(data.user.userId,data.user.loginName,data.auth,data.user);\r\n\t\t\tsFn(data.user);\r\n\t\t},eFn);\r\n\t};\r\n}).constant('AUTH_EVENTS', {\r\n\tGetAuthSuccess: 'auth-success',\r\n\tGetAuthFailed: 'auth-failed',\r\n\tSessionTimeout: 'auth-session-timeout',\r\n\tLogoutSuccess: 'auth-logout-success',\r\n\tLicenseExpired: 'auth-license-expired'\r\n});\r\n/**\r\n * Session\r\n */\r\napp.service('Session', function () {\r\n\tthis.create = function (userId, currentUser,userAuth,userobj) {\r\n\t\tthis.id = userId;\r\n\t\tthis.user = currentUser;\r\n\t\tthis.auth = userAuth;\r\n        this.userobj = userobj;\r\n\t};\r\n\tthis.destroy = function () {\r\n\t\tthis.id = null;\r\n\t\tthis.user = null;\r\n\t\tthis.auth=null;\r\n        this.userobj = null;\r\n\t};\r\n\treturn this;\r\n});\r\n/**\r\n * TOKEN\r\n */\r\napp.service('TOKEN', function ($cookies) {\r\n\tObject.assign(this,{\r\n\t\tkey:'TOKEN',\r\n\t\tget(_default){\r\n\t\t\tlet token = $cookies.get(this.key);\r\n            if (!token || token.trim() === '') {\r\n\t\t\t\tif(_default){\r\n                    token = _default;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn token;\r\n\t\t},\r\n\t\tclear(){\r\n\t\t\t$cookies.remove(this.key);\r\n\t\t}\r\n\t});\r\n\treturn this;\r\n});\r\n/**\r\n * CurrentUserId\r\n */\r\napp.service('CURRENTUSERID', function ($cookies) {\r\n    Object.assign(this,{\r\n        key:'CURRENTUSERID',\r\n        get(_default){\r\n            let userid = $cookies.get(this.key);\r\n            if (!userid || userid.trim() === '') {\r\n                if(_default){\r\n                    userid = _default;\r\n                }\r\n            }\r\n            return userid;\r\n        },\r\n        clear(){\r\n        $cookies.remove(this.key);\r\n    }\r\n});\r\nreturn this;\r\n});\r\n/**\r\n * CURRENTUSER\r\n */\r\napp.service('CURRENTUSER', function ($cookies) {\r\n    Object.assign(this,{\r\n        key:'CURRENTUSER',\r\n        get(_default){\r\n            let token = $cookies.get(this.key);\r\n            if (!token || token.trim() === '') {\r\n                if(_default){\r\n                    token = _default;\r\n                }\r\n            }\r\n            return token;\r\n        },\r\n        clear(){\r\n        $cookies.remove(this.key);\r\n    }\r\n});\r\nreturn this;\r\n});"]}