{"version":3,"sources":["app.login.js"],"names":["login","angular","module","controller","$http","$scope","$cookies","$rootScope","vm","remove","url","method","data","ucode","username","password","then","response","result","put","token","user","name","window","location","replace","code","error","msg","console","log"],"mappings":"AAAA;;;;;AAGA,IAAMA,QAAQC,QAAQC,OAAO,SAAS,CAAC;AACvCF,MAAMG,WAAW,iEAAmB,UAAUC,OAAOC,QAAQC,UAAUC,YAAY;IAC/E,IAAIC,KAAK;IACTF,SAASG,OAAO;IAChBH,SAASG,OAAO;IAChBH,SAASG,OAAO;;;;;;;;;;;;;;IAchBD,GAAGR,QAAQ,YAAY;;;;;;;;;;;;;;;;;;QAkBnBI,MAAM;YACFM,KAAK;YACLC,QAAQ;YACRC,MAAM;gBACFC,OAAOL,GAAGM,UAAUC,UAAUP,GAAGO;;;;WAItCC,KAAK,UAAUC,UAAU;YACxB,IAAIL,OAAOK,SAASL;YACpB,IAAIA,KAAKM,QAAQ;gBACbZ,SAASa,IAAI,SAASP,KAAKA,KAAKQ;;gBAEhCd,SAASa,IAAI,eAAeP,KAAKA,KAAKS,KAAKC;gBAC3CC,OAAOC,SAASC,QAAQ;;;;mBAIrB;gBACH,IAAIb,KAAKc,QAAQd,KAAKc,QAAQ,GAAG;oBAC7BlB,GAAGmB,QAAQf,KAAKgB,MAAI;uBACjB;oBACHpB,GAAGmB,QAAQ;;;;;;WAMpB,UAAUV,UAAU;YACnBT,GAAGmB,QAAQ;;;YAGXE,QAAQC,IAAIb;;;;;;;;;;;;;;;;IApExB","file":"app.login.js","sourcesContent":["/**\r\n * Created by zhhuiyan on 2017/5/8.\r\n */\r\nconst login = angular.module('login', ['ngCookies']);\r\nlogin.controller('LoginController', function ($http, $scope, $cookies, $rootScope) {\r\n    let vm = this;\r\n    $cookies.remove('TOKEN');\r\n    $cookies.remove('CURRENTUSER');\r\n    $cookies.remove('CURRENTUSERID');\r\n//    function validateLicense() {\r\n//      $http({\r\n//        url:'system/auth/validateLicense',\r\n//        method:'GET'\r\n//      }).then(function (response) {\r\n//        var data=response.data;\r\n//        if(data.statusCode==1001){\r\n//          $cookies.put('license',data.messages[0]);\r\n//          window.location.replace('license.html');\r\n//        }\r\n//      })\r\n//    }\r\n//    validateLicense();\r\n    vm.login = function () {\r\n//      if(!vm.username){\r\n//       var userImg=angular.element('#userImg');\r\n//       userImg.prev().focus();\r\n//       return false\r\n//       }\r\n//       if(!vm.password){\r\n//       var pwdImg=angular.element('#pwdImg');\r\n//       pwdImg.prev().focus();\r\n//       return false\r\n//       }\r\n//       if(!vm.captcha){\r\n//       var captcha=angular.element('#captcha');\r\n//       captcha.focus();\r\n//       return false\r\n//       }\r\n//      if (!valid) return false;\r\n\r\n        $http({\r\n            url: '/sign-in',\r\n            method: 'POST',\r\n            data: {\r\n                ucode: vm.username, password: vm.password\r\n//          captcha: vm.captcha,\r\n//          usecaptcha: vm.captcha==vm.password?'yes':'no'\r\n            }\r\n        }).then(function (response) {\r\n            let data = response.data;\r\n            if (data.result) {\r\n                $cookies.put('TOKEN', data.data.token);\r\n                //$cookies.put('CURRENTUSERID', data.data.userId);\r\n                $cookies.put('CURRENTUSER', data.data.user.name);\r\n                window.location.replace('/index.html');\r\n//\r\n//        }else if(data.statusCode==1001){\r\n//          window.location.replace('license.html');\r\n            } else {\r\n                if (data.code && data.code == 1) {\r\n                    vm.error = data.msg+\",请联系管理员!\";\r\n                } else {\r\n                    vm.error = '用户名或密码错误!'\r\n                }\r\n\r\n//          var $captchaImg = angular.element('#captcha_img');\r\n//          refreshCaptcha($captchaImg);\r\n            }\r\n        }, function (response) {\r\n            vm.error = '服务器错误,请联系管理员!';\r\n\r\n            //window.location.replace('/');\r\n            console.log(response);\r\n        });\r\n    };\r\n//    vm.refreshCaptcha = function ($event) {\r\n//      var $captcha = angular.element($event.target);\r\n//      refreshCaptcha($captcha);\r\n//    };\r\n//    //刷新验证码\r\n//    function refreshCaptcha($captcha) {\r\n//      var newSrc = $captcha.attr('src');\r\n//      if (newSrc.includes('v=')) {\r\n//        newSrc = newSrc.substring(0, newSrc.lastIndexOf('?'));\r\n//      }\r\n//      newSrc += '?v=' + new Date().getTime();\r\n//      $captcha.attr('src', newSrc);\r\n//    }\r\n});\r\n"]}