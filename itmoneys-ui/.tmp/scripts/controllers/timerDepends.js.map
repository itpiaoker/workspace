{"version":3,"sources":["controllers/timerDepends.js"],"names":["app","controller","$scope","$rootScope","$location","Util","TimerDepends","Channel","Modeling","Knowledge","Collector","DataSource","$path","path","bind","datasources","query","channels","modelings","knowledges","dependsString","console","log","formatStartTime","date","y","getFullYear","m","getMonth","d","getDate","h","getHours","minute","getMinutes","second","getSeconds","formatEndTime","$confirmModal","$","TimerDefault","timer","enable","repeat","name","first","Date","end","action","collectors","resetForm","timerDepends","angular","copy","resetFormValidateState","ds_form","saveTimer","formValid","fromJson","depends","dataForm","save","rt","message","status","reload","slideUp","uploadFile","$edit_table","$search_table","upload_table","file","myFile","reader","FileReader","onload","result","slideDown","$apply","readAsText","show","clazz","id","searchDataSourceForm","slideToggle","get","ds","delete","deleteId","modal","confirm_yes","find","off","click","$pauseConfirmModal","pause","pauseId","pauseConfirm_yes","list","page","downloadFile","itemId","download","response","fileName","decodeURI","url","URL","createObjectURL","Blob","data","a","document","createElement","body","appendChild","href","target","remove"],"mappings":"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","file":"timerDepends.js","sourcesContent":["'use strict';\r\n\r\napp.controller('TimerDependsController', function ($scope, $rootScope, $location, Util, TimerDepends, Channel, Modeling, Knowledge, Collector, DataSource) {\r\n    $rootScope.$path = $location.path.bind($location);\r\n    $scope.datasources = DataSource.query();\r\n    $scope.channels = Channel.query();\r\n    $scope.modelings = Modeling.query();\r\n    $scope.knowledges = Knowledge.query();\r\n    $scope.dependsString = \"[{\\\"jobId\\\": \\\"name0\\\"},{\\\"jobId\\\": \\\"name1\\\",\\\"parentId\\\": \\\"name0\\\"}]\";\r\n    // $scope.list = $scope.channels;\r\n    // ALTER TABLE TimerDepends ADD EXE_STATE INT DEFAULT 0;\r\n    // ALTER TABLE TimerDepends ADD JOB_TYPE VARCHAR(20);\r\n    // ALTER TABLE TimerDepends ADD TIMER_ACTION VARCHAR(20);\r\n    console.log($scope.channels);\r\n    console.log($scope.modelings);\r\n    console.log($scope.knowledges);\r\n\r\n    const formatStartTime = function (date) {\r\n        let y = date.getFullYear();\r\n        let m = date.getMonth() + 1;\r\n        m = m < 10 ? ('0' + m) : m;\r\n        let d = date.getDate();\r\n        d = d < 10 ? ('0' + d) : d;\r\n        let h = date.getHours() + 1;\r\n        h = h < 10 ? ('0' + h) : h;\r\n        let minute = date.getMinutes();\r\n        let second = date.getSeconds();\r\n        minute = minute < 10 ? ('0' + minute) : minute;\r\n        second = second < 10 ? ('0' + second) : second;\r\n        return y + '-' + m + '-' + d + ' ' + h + ':' + minute + ':' + second;\r\n    };\r\n\r\n    const formatEndTime = function (date) {\r\n        let y = date.getFullYear();\r\n        let m = date.getMonth() + 1;\r\n        m = m < 10 ? ('0' + m) : m;\r\n        let d = date.getDate();\r\n        d = d < 10 ? ('0' + d) : d;\r\n        let h = date.getHours() + 2;\r\n        h = h < 10 ? ('0' + h) : h;\r\n        let minute = date.getMinutes();\r\n        let second = date.getSeconds();\r\n        minute = minute < 10 ? ('0' + minute) : minute;\r\n        second = second < 10 ? ('0' + second) : second;\r\n        return y + '-' + m + '-' + d + ' ' + h + ':' + minute + ':' + second;\r\n    };\r\n\r\n    const $confirmModal = $('#confirmModal');\r\n\r\n    const TimerDefault = {\r\n        timer: {\r\n            enable: false,\r\n            repeat: false,\r\n            name: 'single',\r\n            first: formatStartTime(new Date()),\r\n            end: formatEndTime(new Date),\r\n            action: 'START'\r\n        }\r\n    };\r\n    //采集器\r\n    $scope.collectors = Collector.query();\r\n    // $scope.timers = TimerDepends.query();\r\n    //重置表单\r\n    $scope.resetForm = function () {\r\n        $scope.timerDepends = angular.copy(TimerDefault);\r\n        Util.resetFormValidateState($scope.ds_form);\r\n    };\r\n    $scope.resetForm();\r\n\r\n    //保存\r\n    $scope.saveTimer = function (formValid) {\r\n        if (!formValid) return false;\r\n        console.log(angular.fromJson($scope.dependsString));\r\n        // $scope.timerDepends.timerType = $scope.timerDepends.data.name;\r\n        $scope.timerDepends.depends = angular.fromJson($scope.dependsString);\r\n        let dataForm = $scope.timerDepends;\r\n        TimerDepends.save(dataForm, function (rt) {\r\n            $scope.message = rt;\r\n            if ($scope.message.status === '200') {\r\n                $scope.reload();\r\n                $('.hla-widget-add-table').slideUp();\r\n            }\r\n        });\r\n    };\r\n\r\n    // //\r\n    //\r\n    // $scope.switchCategory = function (id){\r\n    //     switch (id) {\r\n    //         case 'channel' : ;\r\n    //             $scope.list = $scope.channels;\r\n    //             $scope.list.\r\n    //             console.log(id);\r\n    //             console.log($scope.list);\r\n    //             break;\r\n    //         case 'knowledge' : ;\r\n    //             $scope.list = $scope.knowledges;\r\n    //             console.log(id);\r\n    //             console.log($scope.list);\r\n    //             break;\r\n    //         case 'modeling' : ;\r\n    //             $scope.list = $scope.modelings;\r\n    //             console.log(id);\r\n    //             console.log($scope.list);\r\n    //             break;\r\n    //         default :\r\n    //             $scope.list = $scope.channels;\r\n    //             console.log(id);\r\n    //             console.log($scope.list);\r\n    //             break;\r\n    //     }\r\n    // }\r\n\r\n\r\n\r\n\r\n\r\n    $scope.uploadFile = function () {\r\n        let $edit_table = $('.hla-widget-add-table');\r\n        let $search_table = $('.hla-widget-search-table');\r\n        let upload_table = $('.hla-widget-upload-table');\r\n        let file = $scope.myFile;\r\n        let reader = new FileReader();\r\n        reader.onload = function () {\r\n            $scope.timerDepends = angular.fromJson(this.result);\r\n            $edit_table.slideDown();\r\n            $search_table.slideUp();\r\n            upload_table.slideUp();\r\n            $scope.$apply();\r\n        };\r\n        reader.readAsText(file);\r\n    };\r\n\r\n    // $(\"#fileInput2\").on(\"fileuploaded\", function (event, data, previewId, index) {\r\n    //     console.log(data);\r\n    // }\r\n\r\n    // $scope.uploadFile2 = function () {\r\n    //     // let $edit_table = $('.hla-widget-add-table');\r\n    //     // let $search_table = $('.hla-widget-search-table');\r\n    //     // let upload_table = $('.hla-widget-upload-table');\r\n    //     let file = $scope.myFile2;\r\n    //     let reader = new FileReader();\r\n    //     reader.onload = function () {\r\n    //         var timerDepends = angular.fromJson(this.result);\r\n    //         console.log(timerDepends);\r\n    //         // $edit_table.slideDown();\r\n    //         // $search_table.slideUp();\r\n    //         // upload_table.slideUp();\r\n    //         $scope.$apply();\r\n    //     };\r\n    //     reader.readAsText(file);\r\n    // };\r\n\r\n    $scope.show = function (clazz, id) {\r\n        delete  $scope.message;\r\n        let $edit_table = $('.hla-widget-add-table');\r\n        let $search_table = $('.hla-widget-search-table');\r\n        let upload_table = $('.hla-widget-upload-table');\r\n        Util.resetFormValidateState($scope.ds_form);\r\n        switch (clazz) {\r\n            case 'upload':\r\n                $scope.searchDataSourceForm = {};\r\n                $edit_table.slideUp();\r\n                $search_table.slideUp();\r\n                upload_table.slideDown();\r\n                break;\r\n            case 'search':\r\n                $scope.searchDataSourceForm = {};\r\n                $edit_table.slideUp();\r\n                $search_table.slideToggle();\r\n                upload_table.slideUp();\r\n                break;\r\n            case 'add':\r\n                $edit_table.slideToggle();\r\n                $search_table.slideUp();\r\n                upload_table.slideUp();\r\n                $scope.resetForm();\r\n                break;\r\n            case 'edit':\r\n                TimerDepends.get({id: id}, function (ds) {\r\n                    console.log(ds);\r\n                    $scope.timerDepends = ds;\r\n                });\r\n                $edit_table.slideDown();\r\n                $search_table.slideUp();\r\n                upload_table.slideUp();\r\n\r\n                break;\r\n            case 'copy':\r\n                TimerDepends.get({id: id}, function (ds) {\r\n                    $scope.timerDepends = ds;\r\n                    $scope.timerDepends.name = $scope.timer.name + '_copy';\r\n                    delete   $scope.timerDepends.id;\r\n                });\r\n                $edit_table.slideDown();\r\n                $search_table.slideUp();\r\n                upload_table.slideUp();\r\n\r\n                break;\r\n            default:\r\n                $edit_table.slideUp();\r\n                $search_table.slideUp();\r\n                upload_table.slideUp();\r\n                break;\r\n        }\r\n\r\n    };\r\n\r\n\r\n    //删除按钮\r\n    $scope.delete = function (id) {\r\n        $scope.deleteId = id;\r\n        $confirmModal.modal('show');\r\n    };\r\n\r\n    //删除确定\r\n    $scope.confirm_yes = function () {\r\n        TimerDepends.delete({id: $scope.deleteId}, function (rt) {\r\n            $scope.message = rt;\r\n            $scope.reload();\r\n        });\r\n        $confirmModal.modal('hide');\r\n    };\r\n\r\n\r\n    $confirmModal.find('.op_yes').off().click(function () {\r\n        $scope.confirm_yes();\r\n    });\r\n\r\n\r\n    //暂停按钮\r\n    const $pauseConfirmModal = $('#pauseConfirmModal');\r\n\r\n    //暂停按钮\r\n    $scope.pause = function (id) {\r\n        $scope.pauseId = id;\r\n        $pauseConfirmModal.modal('show');\r\n    };\r\n    //暂停确定\r\n    $scope.pauseConfirm_yes = function () {\r\n        TimerDepends.delete({id: $scope.deleteId}, function (rt) {\r\n            $scope.message = rt;\r\n            $scope.reload();\r\n        });\r\n        $pauseConfirmModal.modal('hide');\r\n    };\r\n    //暂停确定\r\n    $pauseConfirmModal.find('.op_yes').off().click(function () {\r\n        $scope.pauseConfirm_yes();\r\n    });\r\n\r\n    //\r\n    $scope.reload = function () {\r\n        $scope.list = TimerDepends.get($scope.page);\r\n        console.log($scope.list);\r\n    };\r\n\r\n    //文件下载\r\n    $scope.downloadFile = function (itemId) {\r\n\r\n//        console.log(sqlItemId);\r\n\r\n        TimerDepends.download({ id: itemId }, function (response) {\r\n            let fileName = '定时器下载';\r\n            fileName = decodeURI(fileName);\r\n            let url = URL.createObjectURL(new Blob([response.data]));\r\n            let a = document.createElement('a');\r\n            document.body.appendChild(a); //此处增加了将创建的添加到body当中\r\n            a.href = url;\r\n            a.download = fileName + '-' + itemId + '.json';\r\n            a.target = '_blank';\r\n            a.click();\r\n            a.remove(); //将a标签移除\r\n        }, function (response) {\r\n//            console.log(response);\r\n        });\r\n    }//\r\n});\r\n"]}